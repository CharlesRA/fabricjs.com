I"Â!<h2 id="introduction_to_fabricjs">Introduction to Fabric.js.</h2>

<p><img src="https://github.com/kangax/fabric.js/raw/master/lib/screenshot.png" style="width:300px;border:1px solid #ccc;margin-bottom:20px" /></p>

<p>Today I‚Äôd like to introduce you to <a href="http://fabricjs.com">Fabric.js</a> - a powerful Javascript library that makes working with HTML5 canvas a breeze. Fabric provides a missing object model for canvas, as well as an SVG parser, layer of interactivity, and a whole suite of other indispensable tools. It is a fully open-source project, licensed under MIT, with many contributions over the years.</p>

<p>Fabric started around 2010, after discovering the pains of working with native canvas API. The original author was creating an interactive design editor for <a href="http://printio.ru">printio.ru</a> - his startup that allows users to design their own apparel. The kind of interactivity they wanted only existed in Flash apps in those days. Even right now, very few come close to what became possible with Fabric.</p>

<p>Let‚Äôs take a closer look!</p>

<h3 id="why_fabric">Why fabric?</h3>

<p><a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/the-canvas-element.html">Canvas</a> allows us to create some <a href="http://net.tutsplus.com/articles/web-roundups/21-ridiculously-impressive-html5-canvas-experiments/">absolutely</a> <a href="http://speckyboy.com/2011/12/07/20-amazing-implementations-of-html5-canvas/">amazing</a> <a href="http://artatm.com/2012/01/23-truly-amazing-and-unbelievable-html5-canvas-and-javascript-experiments/">graphics</a> on the web these days. But the API it provides is <a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/the-canvas-element.html#2dcontext">disappointingly low-level</a>. It‚Äôs one thing if we simply want to draw few basic shapes on canvas and forget about them. But as soon as there‚Äôs need for any kind of interaction, change of picture at any point, or drawing of more complex shapes, situtation changes dramatically.</p>

<p>Fabric aims to solve this problem.</p>

<p>Native canvas methods only allow us to fire off simple graphic commands, blindly modifying entire canvas bitmap. Want to draw a rectangle? Use <code>fillRect(left, top, width, height)</code>. Want to draw a line? Use a combination of <code>moveTo(left, top)</code> and <code>lineTo(x, y)</code>. It‚Äôs as if we‚Äôre <strong>painting canvas with a brush</strong>, layering more and more oil on top, with very little control.</p>

<p>Instead of operating on such low level, Fabric provides simple but powerful object model on top of native methods. It takes care of canvas state and rendering, and lets us work with ‚Äúobjects‚Äù directly.</p>

<p>Let‚Äôs take a look at a simple example demonstrating this difference. Let‚Äôs say we want to draw a red rectangle somewhere on canvas. Here‚Äôs how we would do this with native <canvas> API.</canvas></p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// reference canvas element (with id="c")</span>
<span class="kd">var</span> <span class="nx">canvasEl</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">c</span><span class="dl">'</span><span class="p">);</span>

<span class="c1">// get 2d context to draw on (the "bitmap" mentioned earlier)</span>
<span class="kd">var</span> <span class="nx">ctx</span> <span class="o">=</span> <span class="nx">canvasEl</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="dl">'</span><span class="s1">2d</span><span class="dl">'</span><span class="p">);</span>

<span class="c1">// set fill color of context</span>
<span class="nx">ctx</span><span class="p">.</span><span class="nx">fillStyle</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">red</span><span class="dl">'</span><span class="p">;</span>

<span class="c1">// create rectangle at a 100,100 point, with 20x20 dimensions</span>
<span class="nx">ctx</span><span class="p">.</span><span class="nx">fillRect</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">);</span>
</code></pre></div></div>

<p>Now, let‚Äôs take a look at doing the same with Fabric:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// create a wrapper around native canvas element (with id="c")
var canvas = new fabric.Canvas('c');

// create a rectangle object
var rect = new fabric.Rect({
  left: 100,
  top: 100,
  fill: 'red',
  width: 20,
  height: 20
});

// "add" rectangle onto canvas
canvas.add(rect);
</code></pre></div></div>

<p><img src="/article_assets/1.png" /></p>

<p>At this point, there‚Äôs almost no difference in size, the two examples are pretty similar. However, you can already see how different the approach to working with canvas is. With native methods, we <strong>operate on context</strong>, an object representing entire canvas bitmap. In Fabric, we <strong>operate on objects</strong>, instantiate them, change their properties, and add them to canvas. You can see that these objects are first-class citizens in Fabric land.</p>

<p>But rendering plain red rectangle is just so boring. We could have at least made something fun with it! Perhaps, rotate slightly?</p>

<p>Let‚Äôs try 45 degrees. First, using native <canvas> methods:</canvas></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>var canvasEl = document.getElementById('c');
var ctx = canvasEl.getContext('2d');
ctx.fillStyle = 'red';

ctx.translate(100, 100);
ctx.rotate(Math.PI / 180 * 45);
ctx.fillRect(-10, -10, 20, 20);
</code></pre></div></div>

<p>and now using Fabric:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>var canvas = new fabric.Canvas('c');

// create a rectangle with angle=45
var rect = new fabric.Rect({
  left: 100,
  top: 100,
  fill: 'red',
  width: 20,
  height: 20,
  &lt;b&gt;angle: 45&lt;/b&gt;
});

canvas.add(rect);
</code></pre></div></div>

<p><img src="/article_assets/2.png" /></p>

<p>What happened here?</p>

<p>All we had to do in Fabric is change object‚Äôs ‚Äúangle‚Äù value to <code>45</code>. With native methods however, things become much more ‚Äúfun‚Äù. Remember that we can‚Äôt operate on objects. Instead, we tweak positioning and angle of entire canvas bitmap (<code>ctx.translate</code>, <code>ctx.rotate</code>) to suit our needs. We then draw rectangle again, but remembering to offset bitmap properly (-10, -10), so that it‚Äôs still rendered at the point of 100,100. As a bonus exercise, we had to translate degrees to radians when rotating canvas bitmap.</p>

<p>I'm sure you're starting to see exactly why Fabric exists and how much low-level boilerplate it hides.</p>

<p>But let's take a look at yet another example &mdash; keeping track of canvas state.</p>

<p>What if at some point, we wanted to move that now-familiar red rectangle to a slightly different location on canvas? How would we do this without being able to operate on objects? Would we just call another <code>fillRect</code> on a canvas bitmap?</p>

<p>Not quite. Calling another <code>fillRect</code> command actually draws rectangle on top of whatever is already drawn on canvas. Remember I mentioned painting with a brush earlier? In order to &#8220;move&#8221; it, we'd need to first <strong>erase previously drawn content</strong>, and then draw rectangle at a new location.</p>

<pre>
var canvasEl = document.getElementById('c');

...
ctx.strokRect(100, 100, 20, 20);
...

// erase entire canvas area
<b>ctx.clearRect(0, 0, canvasEl.width, canvasEl.height);
ctx.fillRect(20, 50, 20, 20);</b>
</pre>

<p>And how would we accomplish this with Fabric?</p>

<pre>
var canvas = new fabric.Canvas('c');
...
canvas.add(rect);
...

<b>rect.set({ left: 20, top: 50 });
canvas.renderAll();</b>
</pre>

<p><img src="/article_assets/3.png" /></p>

<p>Notice a very important difference. With Fabric, we no longer need to erase the content before attempting to &#8220;modify&#8221; any content. We still work with objects, simply changing their properties, and then re-render canvas to get a &#8220;fresh picture&#8221;.</p>

<p>Let‚Äôs see which are the objects and tools that fabric.js offers <a href="/objects-and-classes">Objects and classes</a>.</p>

<p>&lt;/div&gt;</p>
:ET